{{#if unit}}
  <div class="unit-tree">
    <div class="box">
      {{#if (or (or session.current_user.permission.unit_create session.current_user.permission.unit_edit)  session.current_user.permission.unit_delete)}}
        <div class="toolbar">
          {{#bs-dropdown class="unit-menu" as |dd|}}
            {{#dd.toggle}}
              <button type="button" class="tb tb-default">{{fa-icon "gear"}}</button>
            {{/dd.toggle}}
            {{#dd.menu class="pull-right"}}
              {{#if session.current_user.permission.unit_create}}
                <li><a {{action 'addUnit'}} href="#">{{fa-icon "plus"}} Add</a></li>
              {{/if}}

              {{#if session.current_user.permission.unit_edit}}
                <li><a {{action 'editUnit'}} href="#">{{fa-icon "pencil-square-o"}} Edit</a></li>
              {{/if}}

              {{#if session.current_user.permission.unit_delete}}
                <li><a {{action 'deleteUnit'}} style="color: #f00;" href="#">{{fa-icon "remove"}} Delete</a></li>
              {{/if}}
            {{/dd.menu}}
          {{/bs-dropdown}}
        </div>
      {{/if}}


      <div class="box-header drop-target" style={{unitStyle}} data-unitid={{unit.id}} data-dest="players" {{action 'toggleUnits'}}>
        <div class="unit-name">
          {{#if unit.units}}
              <i class="fixedWidth fa {{if showUnits "fa-chevron-down" "fa-chevron-right"}}"></i>
              {{#if unit.img}}
                <img class="unit-img" src={{unit.img}}>
              {{/if}}
              {{unit.name}}
          {{else}}
            <i class="fixedWidth fa"></i>
            {{#if unit.img}}
              <img class="unit-img" src={{unit.img}}>
            {{/if}}
            {{unit.name}}
          {{/if}}

        {{#if unit.description}}
          <div class="unit-desc">
            {{unit.description}}
          </div>
        {{/if}}
        </div>
      </div>

      <div style="clear:both;"/>

      <div class="player-container drop-target" data-unitid={{unit.id}} data-dest="leaders">
        <a class="toggleElement" {{action 'toggleLeader'}}>
          <i class="fixedWidth fa {{if showLeader "fa-chevron-circle-down" "fa-chevron-circle-right"}}"></i>
          Leader{{#if unit.leaders.length}}: [ {{unit.leaders.length}} ]{{/if}}
        </a>

        {{#if showLeader}}
          <div class="unit-pilots">
            {{#each unit.leaders as |lead|}}
              {{player-details player=lead draggable=true unit=unit type="leader"}}
            {{/each}}
          </div>

        {{else}}

          {{#each leaders as |lead|}}
            <img class="mem-sm" style="width:16px; height: 16px;" src={{lead.avatar}}/>
          {{/each}}

        {{/if}}

        <div style="clear: both"/>
      </div>

      <div class="player-container drop-target" data-unitid={{unit.id}} data-dest="players">
        <a class="toggleElement" {{action 'toggleMembers'}}>
          <i class="fixedWidth fa {{if showMembers "fa-chevron-circle-down" "fa-chevron-circle-right"}}"></i>
          Member{{#if unit.players.length}}: [ {{unit.players.length}} ]{{/if}}
        </a>

        {{#if showMembers}}
          <div class="unit-pilots">
            {{#each unit.players as |mem|}}
              {{player-details player=mem draggable=true unit=unit type="player"}}
            {{/each}}
          </div>
        {{else}}
          {{#each unit.players as |mem|}}
            <img class="mem-sm" style="width:16px; height: 16px;" src={{mem.avatar}}/>
          {{/each}}
        {{/if}}
      </div>


      <div class="player-container drop-target" data-unitid={{unit.id}} data-dest="applicants">
        <a class="toggleElement" {{action 'toggleApplicants'}}>
          <i class="fixedWidth fa {{if showApplicants "fa-chevron-circle-down" "fa-chevron-circle-right"}}"></i>
          Applications{{#if unit.applicants.length}}: [ {{unit.applicants.length}} ]{{/if}}
        </a>

        {{#if showApplicants}}
          <div class="unit-pilots">
            {{#each unit.applicants as |mem|}}
              {{player-details player=mem draggable=true unit=unit type="applicant"}}
            {{/each}}
          </div>
        {{/if}}
      </div>

      
    </div>

    {{#if showUnits}}
      <div class="unit-bg">
        <div class="child-units">
          {{#each unit.units as |child|}}
            {{unit-tree unit=child level=(-- level)}}
          {{/each}}
        </div>
      </div>
    {{/if}}

    {{yield}}
  </div>

{{/if}}
